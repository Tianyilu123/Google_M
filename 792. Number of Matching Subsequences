class Solution {
    public int numMatchingSubseq(String S, String[] words) {
        int res = 0, cur, i;
        List<Integer>[] pos = positions(S);
        for(String word : words) {
            for(i=0, cur=0; i<word.length(); i++, cur++) {
                char c = word.charAt(i);
                cur = search(pos[c-'a'], cur);
                if(cur == -1) break;
            }
            if(cur != -1) res++;
        }
        return res;
    }
    
    private int search(List<Integer> pos, int cur) {
        if(pos == null) return -1;
        int lo=0, hi=pos.size()-1;
        if(pos.get(lo) >= cur)
            return pos.get(lo);
        if(pos.get(hi) < cur)
            return -1;
        while(lo <= hi) {
            int mid = (lo+hi)/2;
            if(pos.get(mid) == cur)
                return pos.get(mid);
            else if(pos.get(mid) < cur)
                lo = mid+1;
            else
                hi = mid-1;
        }
        
        return pos.get(lo);
    }
    
    private List<Integer>[] positions(String S) {
        List<Integer>[] pos = new List[26];
        for(int i=0; i<S.length(); i++) {
            char c = S.charAt(i);
            if(pos[c-'a'] == null) {
                pos[c-'a'] = new ArrayList<>();
            }
            pos[c-'a'].add(i);
        }
        return pos;
    }
}
